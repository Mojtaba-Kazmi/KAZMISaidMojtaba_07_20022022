"use strict";function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(r,e){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r)){var t=[],n=!0,a=!1,s=void 0;try{for(var u,i=r[Symbol.iterator]();!(n=(u=i.next()).done)&&(t.push(u.value),!e||t.length!==e);n=!0);}catch(r){a=!0,s=r}finally{try{n||null==i.return||i.return()}finally{if(a)throw s}}return t}}function _arrayWithHoles(r){if(Array.isArray(r))return r}var jwt=require("jsonwebtoken"),queryDbb=require("../queryBdd");module.exports=function(e,t,n){var a,s,u,i,o,c,l,b,y,p;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,(a=e.headers)&&a.authorization){r.next=4;break}return r.abrupt("return",t.status(401).json({message:"Missing Authorization header"}));case 4:if(s=a.authorization.split(" "),u=_slicedToArray(s,2),i=u[0],o=u[1],i&&"bearer"===i.toLowerCase()&&o){r.next=7;break}return r.abrupt("return",t.status(401).json({message:"Header format is Authorization: Bearer token"}));case 7:return c=jwt.verify(o,"RANDOM_TOKEN_SECRET"),l=c.userId,b=c.isAdmin,y=[l],r.next=13,regeneratorRuntime.awrap(queryDbb.selectIdFromUser(y));case 13:if(p=r.sent,r.prev=14,p[0]){r.next=17;break}return r.abrupt("return",t.status(400).json({error:"l'utilisateur n'existe pas."}));case 17:r.next=22;break;case 19:return r.prev=19,r.t0=r.catch(14),r.abrupt("return",t.status(500).json({error:"mysql2"}));case 22:return e.user=l,e.userIsAdmin=b,r.abrupt("return",n());case 27:return r.prev=27,r.t1=r.catch(0),r.abrupt("return",t.status(401).json({message:"Invalid token"}));case 30:case"end":return r.stop()}},null,null,[[0,27],[14,19]])};
//# sourceMappingURL=auth.min.js.map
